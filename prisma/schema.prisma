generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Posts {
  id          Int         @id @default(autoincrement())
  content     String
  likes       Int
  dislikes    Int
  authorId    Int
  communityId Int
  comments    Comments[]
  author      Users       @relation(fields: [authorId], references: [id])
  community   Communities @relation(fields: [communityId], references: [id])
}

model Comments {
  id       Int    @id @default(autoincrement())
  content  String
  likes    Int
  dislikes Int
  postId   Int
  authorId Int
  author   Users  @relation(fields: [authorId], references: [id])
  post     Posts  @relation(fields: [postId], references: [id])
}

model Communities {
  id                  Int                   @id @default(autoincrement())
  name                String
  followers           Int
  followedCommunities FollowedCommunities[]
  posts               Posts[]
}

model Messages {
  id             Int           @id @default(autoincrement())
  message        String
  timestamp      DateTime
  senderId       Int
  conversationId Int
  conversation   Conversations @relation(fields: [conversationId], references: [id])
  sender         Users         @relation(fields: [senderId], references: [id])
}

model Conversations {
  id           Int        @id @default(autoincrement())
  timestamp    DateTime
  messages     Messages[]
  participants Users[]    @relation("ConversationsToUsers")
}

model Users {
  id                  Int                   @id @default(autoincrement())
  username            String  @unique
  passwordHash        String
  moderator           Boolean               @default(false)
  email               String
  birthdate           DateTime
  comments            Comments[]
  followedCommunities FollowedCommunities[]
  messages            Messages[]
  posts               Posts[]
  conversations       Conversations[]       @relation("ConversationsToUsers")
}

model FollowedCommunities {
  userId      Int
  communityId Int
  followedAt  DateTime    @default(now())
  community   Communities @relation(fields: [communityId], references: [id])
  user        Users       @relation(fields: [userId], references: [id])

  @@id([userId, communityId])
}

model Session {
  id        String   @id @default(uuid())
  sid       String   @unique
  data      String
  expiresAt DateTime
}
